<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Back of House â€” Catering Orders</title>
<link rel="stylesheet" href="/css/orders.css">
</head>
<body class="<%= viewMode === 'boh' && bohSubView === 'simplified' ? 'simplified-view' : '' %>">
<header>Chick-fil-A <%= viewMode === 'foh' ? 'Front of House (FOH)' : 'Back of House (BOH)' %> Orders â€” <%= todayStr %></header>
<a href="/dashboard" class="back-btn">â¬… Back to Dashboard</a>
<% if (viewMode !== 'foh') { %>
<div class="view-toggle">
  <button id="fullViewBtn" class="<%= viewMode === 'boh' && (typeof bohSubView === 'undefined' || bohSubView === 'full') ? 'active' : '' %>">ğŸ“‹ Full View</button>
  <button id="simplifiedViewBtn" class="<%= viewMode === 'boh' && bohSubView === 'simplified' ? 'active' : '' %>">ğŸ½ï¸ Simplified View</button>
</div>
<% } %>
<button id="refreshBtn" class="refresh-button">ğŸ”„ Refresh Orders</button>
<span id="refreshStatus" style="margin-left: 10px; color: green;"></span>

<script>
// Refresh button functionality (available in both BOH and FOH views)
document.getElementById('refreshBtn').addEventListener('click', async () => {
  const statusEl = document.getElementById('refreshStatus');
  statusEl.textContent = 'Refreshing... â³';

  try {
    const res = await fetch('/fetch-catering');
    const text = await res.text();
    statusEl.textContent = text.includes('âœ…') ? 'âœ… Refreshed successfully!' : 'âš ï¸ Something went wrong.';
    console.log(text);
    
    // Optional: Reload the catering list after refresh
    setTimeout(() => location.reload(), 1500);
  } catch (err) {
    console.error(err);
    statusEl.textContent = 'âŒ Failed to refresh orders';
  }
});

// View toggle functionality (only exists in BOH view)
const fullViewBtn = document.getElementById('fullViewBtn');
const simplifiedViewBtn = document.getElementById('simplifiedViewBtn');

if (fullViewBtn) {
  fullViewBtn.addEventListener('click', () => {
    window.location.href = '/orders?view=boh&subview=full';
  });
}

if (simplifiedViewBtn) {
  simplifiedViewBtn.addEventListener('click', () => {
    window.location.href = '/orders?view=boh&subview=simplified';
  });
}
</script>
<div class="container">
  <div class="orders">
    <% if (!orders.length) { %>
      <p style="padding:10px;">No catering orders for today.</p>
    <% } else { %>
      <% orders.forEach(order => { %>
        <div class="order" 
     data-uid="<%= order.uid %>" 
     data-order='<%- JSON.stringify(order).replace(/'/g, "&#39;") %>'>
  <strong><%= order.team %></strong><br>
  Time: <%= order.time %>
</div>
      <% }) %>
    <% } %>
  </div>

  <div class="details" id="details">
    <span class="close-btn" onclick="closeDetails()">âœ–</span>
    <div id="detailsContent"></div>
  </div>
</div>

<script>
  const traySizes = <%- JSON.stringify(traySizes) %>;
  const viewMode = '<%= viewMode %>'; // 'boh' or 'foh'
  const bohSubView = '<%= bohSubView %>'; // 'full' or 'simplified' (only used in BOH mode)
</script>
<script src="/js/orders.js"></script>
</body>
</html>
